<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HK Commute Duo</title>
    <style>
        :root { --primary: #004494; --accent: #ffcc00; --danger: #d32f2f; --bg: #f0f2f5; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; }
        .container { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        .column { flex: 1; min-width: 340px; max-width: 450px; background: white; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 15px; }
        .header { background: var(--primary); color: white; padding: 15px; text-align: center; }
        .header h2 { margin: 0; font-size: 1rem; }
        .header p { margin: 4px 0 0; font-size: 0.8rem; opacity: 0.9; }
        .bus-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; border-bottom: 1px solid #eee; }
        .bus-row:last-child { border-bottom: none; }
        .route-id { font-size: 1.4rem; font-weight: 800; color: var(--primary); width: 60px; }
        .dest-info { flex-grow: 1; font-size: 0.75rem; color: #666; padding-left: 10px; }
        .eta-box { text-align: right; min-width: 70px; }
        .eta-time { font-size: 1.2rem; font-weight: bold; color: var(--danger); }
        .refresh-btn { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: var(--accent); border: none; box-shadow: 0 4px 10px rgba(0,0,0,0.3); font-weight: bold; cursor: pointer; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div class="container">
        <div class="column">
            <div class="header">
                <h2>TO WORK / NORTH POINT</h2>
                <p>Start: Yip Yee Mansion (業漁大廈)</p>
            </div>
            <div id="list-work"></div>
        </div>

        <div class="column">
            <div class="header">
                <h2>TO HOME / TIN WAN</h2>
                <p>Start: Healthy Village (健康邨)</p>
            </div>
            <div id="list-home"></div>
        </div>
    </div>

    <button class="refresh-btn" onclick="updateAll()">REFRESH</button>

<script>
    const STOPS = {
        YIP_YEE: "002425",
        HEALTHY: "001217"
    };

    const ROUTES_WORK = [
        { id: "38", dest: "Sun Beam / North Pt" },
        { id: "42", dest: "Sun Beam / North Pt" },
        { id: "77", dest: "Healthy Village" },
        { id: "77X", dest: "Fire Station (Exp)" },
        { id: "99", dest: "Healthy Village" }
    ];

    const ROUTES_HOME = [
        { id: "38", dest: "Ocean Court / Chi Fu" },
        { id: "42", dest: "Ocean Court / Wah Fu" },
        { id: "77", dest: "Ocean Court / Tin Wan" },
        { id: "99", dest: "Ocean Court / Horizons" }
    ];

    async function getETA(route, stop) {
        try {
            const res = await fetch(`https://rt.data.gov.hk/v2/transport/citybus/eta/CTB/${stop}/${route}`);
            const json = await res.json();
            if (!json.data || json.data.length === 0) return "--";
            const bus = json.data[0];
            if (!bus.eta) return "No data";
            const diff = Math.round((new Date(bus.eta) - new Date()) / 60000);
            return diff <= 0 ? "Arr" : `${diff}m`;
        } catch { return "err"; }
    }

    async function renderColumn(elementId, routes, stopId) {
        const list = document.getElementById(elementId);
        list.innerHTML = '<p style="text-align:center; padding:10px;">Updating...</p>';
        let html = "";
        for (let r of routes) {
            const time = await getETA(r.id, stopId);
            html += `
            <div class="bus-row">
                <div class="route-id">${r.id}</div>
                <div class="dest-info">to ${r.dest}</div>
                <div class="eta-box"><span class="eta-time">${time}</span></div>
            </div>`;
        }
        list.innerHTML = html;
    }

    function updateAll() {
        renderColumn('list-work', ROUTES_WORK, STOPS.YIP_YEE);
        renderColumn('list-home', ROUTES_HOME, STOPS.HEALTHY);
    }

    updateAll();
    setInterval(updateAll, 30000); // Auto-refresh every 30s
</script>
</body>
</html>
