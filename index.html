// 1. Updated Route Config with explicit Destinations
    const routeConfig = {
      "38":  { out: "Chi Fu", in: "North Point" },
      "42":  { out: "Ap Lei Chau", in: "North Point" },
      "77":  { out: "Shau Kei Wan", in: "Tin Wan" },
      "77X": { out: "Sai Wan Ho", in: "Wah Kwai" },
      "99":  { out: "Shau Kei Wan", in: "South Horizons" },
      "98":  { out: "Aberdeen", in: "Lei Tung" },
      "94A": { out: "Circular", in: "Circular" },
      "91":  { out: "Ap Lei Chau", in: "Central" }
    };

    // 2. Revised ETA logic to show the Destination Name
    document.getElementById('getETA').onclick = async () => {
        const route = routeSelect.value;
        const dirInput = directionSelect.value; 
        const dir = (dirInput === "dir1") ? "outbound" : "inbound";
        const destination = (dir === "outbound") ? routeConfig[route].out : routeConfig[route].in;
        
        etaTableBody.innerHTML = `<tr><td>正在查詢往 ${destination} 的班次...</td></tr>`;

        try {
            const response = await fetch(`${API_BASE}/eta/CTB/${selectedStopId}/${route}`);
            const data = await response.json();

            // Filter for the correct direction
            const upcoming = data.data
                .filter(item => item.dir.toLowerCase() === dir.toLowerCase())
                .sort((a, b) => new Date(a.eta) - new Date(b.eta));

            if (!upcoming || upcoming.length === 0) {
                etaTableBody.innerHTML = `<tr><td class="eta">往 ${destination} 暫無班次</td></tr>`;
            } else {
                etaTableBody.innerHTML = upcoming.map(item => {
                    const etaTime = new Date(item.eta);
                    const diffMins = Math.floor((etaTime - new Date()) / 60000);
                    const display = diffMins <= 0 ? "即將抵達" : `${diffMins} 分鐘`;
                    
                    return `<tr><td class="eta">${display}<br><small>終點站: ${destination}</small></td></tr>`;
                }).join('');
            }
        } catch (error) {
            etaTableBody.innerHTML = `<tr><td class="status-error">連線錯誤</td></tr>`;
        }
    };
