async function findStopId(route, direction) {
    try {
        document.getElementById('status').textContent = 'Finding stop...';
        const res = await fetch(`${BASE_URL}route-stop/${COMPANY}/${route}/${direction}`);
        const data = await res.json();

        if (!data.data || data.data.length === 0) {
            console.log(`No stops for ${route} ${direction}`);
            return null;
        }

        // Very lenient match: key words anywhere, ignore case/spaces/punctuation
        const keywordsEn = ['yip', 'yee', 'mansion'];
        const keywordsTc = ['業漁', '大廈'];

        const stop = data.data.find(s => {
            const enLower = (s.name_en || '').toLowerCase().replace(/[^a-z0-9]/g, ''); // remove commas/spaces/etc
            const tcLower = (s.name_tc || '').toLowerCase();

            const enHasAll = keywordsEn.every(kw => enLower.includes(kw));
            const tcHasAny = keywordsTc.some(kw => tcLower.includes(kw));

            return enHasAll || tcHasAny || (enLower.includes('aberdeen') && enLower.includes('main') && enLower.includes('yip'));
        });

        if (stop) {
            console.log('Matched stop:', stop.name_en, stop.name_tc, 'ID:', stop.stop);
            return stop.stop;
        } else {
            console.log('No match. Showing first 5 stops for debug:', 
                data.data.slice(0,5).map(s => `${s.seq}: ${s.name_en || s.name_tc} (ID: ${s.stop})`)
            );

            // Hardcoded fallback for known routes/stops (update if you find the real ID)
            if (route === 'A10') return '001213'; // Example from some data - test and replace
            if (route === '98') return null; // Remove if we find real ID later

            return null;
        }
    } catch (err) {
        console.error('Stops fetch failed:', err);
        document.getElementById('status').innerHTML = `<span class="error">Failed to load stops: ${err.message}. Check internet or try GitHub Pages.</span>`;
        return null;
    }
}
